<!DOCTYPE html>
<html><head>
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
</head><body>
<style>
@font-face {
  font-family: 'Borel Sans';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url(./Borel-Regular-subset.woff2);
}
@font-face {
  font-family: 'ABeeZee';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url(./ABeeZee-Regular.woff2);
}
@font-face {
  font-family: 'Chill Yunmo';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url(./ChillYunmoGothicMedium_subset.woff2);
  /* src: url(./ChillYunmoGothicMedium_scaled.ttf); /* For debug usage */
}
@font-face {
  font-family: 'Sono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url(./Sono_Monospace-Regular.woff2);
}
html {
  font-size: calc(16px + 0.5vw);  /* fallback */
  font-size: min(16px + 0.5vw, 20px);
  font-family: 'ABeeZee', 'Chill Yunmo', sans-serif;
  line-height: 1.5;
}
body {
  margin: 0;
  background: #fdfdfd;
  color: #111;
}
@media (prefers-color-scheme: dark) {
  body {
    background: #343434;
    color: #f4f4f4;
  }
}
body:lang(zh), *[lang='zh'] {
  font-family: 'Chill Yunmo', 'ABeeZee', sans-serif;
}
header {
  margin: 0 0 -0.5ex;
  /* Disable collapsing of padding */
  display: inline-block;
  width: 100%;

  background-image: url(./banner_bg.svg);
  background-position: bottom;
  background-repeat: none;
  background-size: cover;
}
header h1 {
  font-family: 'Borel Sans', sans-serif;
  font-size: 2.5rem;
  letter-spacing: 0.075em;
  line-height: 1;
  margin: 0;
  padding: 1.5ex 1rem 0.5ex;  /* padding-left fallback */
  padding-left: clamp(1rem, 50vw - 20rem, 10vw);
}
main {
  margin: 1ex auto;
  /* width: clamp(80vw, 40rem, 100vw - 2rem); */
  min-width: 80vw;
  width: 40rem;
  max-width: calc(100vw - 2rem);
}
p {
  margin: 1ex 0 1ex 0;
}
tt {
  font-family: 'Sono', monospace;
}
tt.anybreak {
  line-break: anywhere;
}
tt.code {
  display: inline-block;
  width: calc(100% - 0.9em);
  overflow-x: scroll;
  white-space: nowrap;
  padding: 0.3ex 0.6em 0.3ex 0.3em;
  background: #fafafa;
  border-radius: 0.5em;
  border: #eee 0.05em solid;
}
.command {
  user-select: all;
}
.command::before {
  content: '> ';
  color: #ccc;
}
.command-output {
  color: #81c;
}
@media (prefers-color-scheme: dark) {
  tt.code {
    background: #282828;
    border-color: #333;
  }
  .command-output {
    color: #e9f;
  }
}
</style>
<header>
  <h1>ABRC</h1>
</header>
<main>
  <p><strong>ABRC</strong> (Ayu’s Beacon of Randomness on Clouds) is a public</p>
  <p lang='zh-Hans'>《千字文》原名 original 为《次韵王羲之书千字》，南朝梁（502年─549年）周兴嗣所作的一首长韵文。它是一篇由一千个不重复的汉字组成的文章。据说是梁武帝取了王羲之写的一千个字体，令其亲人练习书法，而后觉得杂乱无章，于是又命周兴嗣（470年─521年）编为一篇文章。</p>
  <p lang='zh-Hans'>《千字文》由“天地玄黄”到“焉哉乎也”，总共250个隔句押韵的四字短句构成，内容包含天文、地理、政治、经济、社会、历史、伦理，整篇文章一字都不重复。</p>
  <p>Latest: {{ latestTimestampISO }} ({{ latestTimestamp }})<br><tt class='anybreak'>{{ latestOutputPrefixSuffix }}</tt></p>
  <hr>
  <div>
    <p><strong>1.</strong> Download the images involved.</p>
    <p><tt class='code'>
      <span class='command'>curl{{~a' details
        &nbsp;\<br>&nbsp;&nbsp;{{ message }} -o {{ index }}.{{ extension }}
      a'~}}</span><br>
    </tt></p>

    <p><strong>2.</strong> Verify the signatures.</p>
    <p><tt class='code'>
      <span class='command'>openssl dgst -sha3-224{{~b1' details &nbsp;{{ index }}.{{ extension }} b1'~}}</span><br>
      <span class='command-output'>{{~b2' details
        SHA3-224({{ index }}.{{ extension }})= {{ digest }}<br>
      b2'~}}</span>
      <span class='command'>curl https://abrc.ayu.land/{{ latestTimestamp }} | perl -nle 'print join "\n", m/"digest":"([0-9a-f]+)"/g'</span><br>
      <span class='command-output'>{{~b3' details
        {{ digest }}<br>
      b3'~}}</span>
    </tt></p>

    <p><strong>3.</strong> Calculate the 4096-byte hash from the files.</p>
    <p><tt class='code'>
      <span class='command'>curl https://abrc.ayu.land/hash.c -o hash.c</span><br>
      <span class='command'>cc -O2 hash.c -o hash</span><br>
      <span class='command'>HASH=$(./hash{{~c' details &nbsp;{{ index }}.{{ extension }} c'~}}); echo $HASH</span><br>
      <span class='command-output'>{{ contentHashPrefixSuffix }}</span><br>
    </tt></p>

    <p><strong>4.</strong> Verify that local randomness matches the precommitment digest in the previous pulse.</p>
    <p><tt class='code'>
      <span class='command'>PRECM=$(curl https://abrc.ayu.land/{{ previousTimestamp }} | perl -ne 'm/"precommit":"([0-9a-f]+)"/; print "$1"'); echo $PRECM</span><br>
      <span class='command-output'>{{ precommitment }}</span><br>
      <span class='command'>LOCAL=$(curl https://abrc.ayu.land/{{ latestTimestamp }} | perl -ne 'm/"local":"([0-9a-f]+)"/; print "$1"'); echo $LOCAL</span><br>
      <span class='command-output'>{{ localRandomnessPrefixSuffix }}</span><br>
      <span class='command'>xxd -r -p &lt;&lt;&lt; $LOCAL | openssl dgst -sha3-512</span><br>
      <span class='command-output'>{{ precommitment }}</span><br>
    </tt></p>

    <p><strong>5.</strong> Retrieve the previous output.</p>
    <p><tt class='code'>
      <span class='command'>PREV=$(curl https://abrc.ayu.land/{{ previousTimestamp }} | perl -ne 'm/"output":"([0-9a-f]+)"/; print "$1"'); echo $PREV</span><br>
      <span class='command-output'>{{ previousOutputPrefixSuffix }}</span><br>
    </tt></p>

    <p><strong>6.</strong> Finally, verify that the bitwise exclusive-or of the hash of files (step <strong>3</strong>), the local randomness (step <strong>4</strong>), and previous output (step <strong>5</strong>) are the same.</p>
    <p><tt class='code'>
      <span class='command'>python3 -c "print('%08192x' % (0x$HASH ^ 0x$LOCAL ^ 0x$PREV))"</span><br>
      <span class='command-output'>{{ latestOutputPrefixSuffix }}</span><br>
    </tt></p>
  </div>
</main>
</body></html>
